<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Smart Home</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
</head>
<body>

    <header class="navbar">
        <div class="nav-wrapper">
            <a href="/" class="logo">
                <h1>Smart<span>Home</span></h1>
            </a>
            <div class="nav-links">
                <button id="theme-toggle" class="btn-sm" title="Toggle Theme">
                    <svg viewBox="0 0 24 24" class="icon-svg"><path d="M12 3a9 9 0 1 0 9 9c0-.46-.04-.92-.1-1.36a5.389 5.389 0 0 1-4.4 2.26 5.403 5.403 0 0 1-3.14-9.8c-.44-.06-.9-.1-1.36-.1z"/></svg>
                </button>
                <a href="/devices" class="btn-sm">
                    <svg viewBox="0 0 24 24" class="icon-svg"><path d="M4 11h6a1 1 0 0 0 1-1V4a1 1 0 0 0-1-1H4a1 1 0 0 0-1 1v6a1 1 0 0 0 1 1zm10 0h6a1 1 0 0 0 1-1V4a1 1 0 0 0-1-1h-6a1 1 0 0 0-1 1v6a1 1 0 0 0 1 1zM4 21h6a1 1 0 0 0 1-1v-6a1 1 0 0 0-1-1H4a1 1 0 0 0-1 1v6a1 1 0 0 0 1 1zm10 0h6a1 1 0 0 0 1-1v-6a1 1 0 0 0-1-1h-6a1 1 0 0 0-1 1v6a1 1 0 0 0 1 1z"/></svg> 
                    Devices
                </a>
                <a href="/logout" class="btn-sm" style="color: #ff6b6b;">
                    <svg viewBox="0 0 24 24" class="icon-svg"><path d="M10.09 15.59L11.5 17l5-5-5-5-1.41 1.41L12.67 11H3v2h9.67l-2.58 2.59zM19 3H5a2 2 0 0 0-2 2v4h2V5h14v14H5v-4H3v4a2 2 0 0 0 2 2h14c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2z"/></svg>
                    Logout
                </a>
            </div>
        </div>
    </header>

    <section class="hero">
        <div class="container reveal">
            <h2>Intelligent Living,<br><span>Simplified.</span></h2>
            <p>Offline Home Automation System</p>
            
            <a href="#control-panel" class="btn-hero">Control Devices</a>

            <div class="icon-orbit">
                <svg class="main-icon" viewBox="0 0 24 24" fill="currentColor"><path d="M10 20v-6h4v6h5v-8h3L12 3 2 12h3v8z"/></svg>
                <div class="float-icon icon-1"><svg viewBox="0 0 24 24"><path d="M1 9l2 2c4.97-4.97 13.03-4.97 18 0l2-2C16.93 2.93 7.08 2.93 1 9zm8 8l3 3 3-3c-1.65-1.66-4.34-1.66-6 0zm-4-4l2 2c2.76-2.76 7.24-2.76 10 0l2-2C15.14 9.14 8.87 9.14 5 13z"/></svg></div>
                <div class="float-icon icon-2"><svg viewBox="0 0 24 24"><path d="M9 21c0 .55.45 1 1 1h4c.55 0 1-.45 1-1v-1H9v1zm3-19C8.14 2 5 5.14 5 9c0 2.38 1.19 4.47 3 5.74V17c0 .55.45 1 1 1h6c.55 0 1-.45 1-1v-2.26c1.81-1.27 3-3.36 3-5.74 0-3.86-3.14-7-7-7z"/></svg></div>
                <div class="float-icon icon-3"><svg viewBox="0 0 24 24"><path d="M12 12c0-3 2.5-5.5 5.5-5.5S23 9 23 12H12zm0 0c0 3-2.5 5.5-5.5 5.5S1 15 1 12h11zm0 0c-3 0-5.5-2.5-5.5-5.5S9 1 12 1v11zm0 0c3 0 5.5 2.5 5.5 5.5S15 23 12 23V12z"/></svg></div>
                <div class="float-icon icon-4"><svg viewBox="0 0 24 24"><path d="M15 13V5c0-1.66-1.34-3-3-3S9 3.34 9 5v8c-1.21.91-2 2.37-2 4 0 2.76 2.24 5 5 5s5-2.24 5-5c0-1.63-.79-3.09-2-4zm-4-2.5V5c0-.55.45-1 1-1s1 .45 1 1v5.5l-2-.0z"/></svg></div>
            </div>
        </div>
    </section>

    <main id="control-panel" class="container">
        
        {% if device_states|length == 1 %}
            {% set room = device_states.keys()|list|first %}
            {% set devices = device_states[room] %}
            
            <h3 class="text-center reveal" style="margin-bottom:10px;">{{ room.replace('_', ' ')|title }}</h3>
            
            <div class="mic-wrapper reveal" style="text-align:center; margin-bottom: 40px; margin-top: 0;">
                <button class="btn-mic push-to-talk" data-room="{{ room }}" title="Voice Command">
                    <svg viewBox="0 0 24 24"><path d="M12 14c1.66 0 3-1.34 3-3V5c0-1.66-1.34-3-3-3S9 3.34 9 5v6c0 1.66 1.34 3 3 3z"/><path d="M17 11c0 2.76-2.24 5-5 5s-5-2.24-5-5H5c0 3.53 2.61 6.43 6 6.92V21h2v-3.08c3.39-.49 6-3.39 6-6.92h-2z"/></svg>
                </button>
                <div class="mic-status" style="margin-top:10px; font-size:14px; opacity:0.8;">Tap to Speak</div>
            </div>

            <div class="card-container">
                <div class="room-card reveal">
                    <div class="device-list">
                        {% for relay, data in devices.items() if relay.startswith('relay') %}
                            {% set relay_id = "switch-" + room + "-" + relay %}
                            {% set motion_id = "motion-" + room + "-" + relay %}
                            <div class="device-item">
                                <span>{{ data.label }}</span>
                                <div class="controls">
                                    <svg class="motion-icon {% if data.get('motion_control') %}active{% endif %}" 
                                         id="{{ motion_id }}"
                                         data-room="{{ room }}" data-relay="{{ relay }}"
                                         viewBox="0 0 24 24"><path d="M13.49 5.48c1.1 0 2-.9 2-2s-.9-2-2-2-2 .9-2 2 .9 2 2 2zm-3.6 13.9l1-4.4 2.1 2v6h2v-7.5l-2.1-2 .6-3c1.3 1.5 3.3 2.5 5.5 2.5v-2c-1.9 0-3.5-1-4.3-2.4l-1-1.6c-.4-.6-1-1-1.7-1-.3 0-.5.1-.8.1l-5.2 2.2v4.7h2v-3.4l1.8-.7-1.6 8.1-4.9-1-.4 2 7.7 1.6z"/></svg>
                                    <label class="switch">
                                        <input type="checkbox" class="relay-toggle" 
                                               id="{{ relay_id }}"
                                               data-room="{{ room }}" data-relay="{{ relay }}" 
                                               {% if data.status == 'ON' %}checked{% endif %}>
                                        <span class="slider"></span>
                                    </label>
                                </div>
                            </div>
                        {% endfor %}
                    </div>
                </div>
            </div>

        {% else %}
            <h3 class="text-center reveal" style="margin-bottom:20px;">Smart Dashboard</h3>
            
            <div class="dashboard-grid reveal">
                {% for room, devices in device_states.items() %}
                <div class="room-module" onclick="openRoomModal('{{ room }}')">
                    <div class="status-badge {% if room in device_room_map %}bound{% endif %}" 
                         title="{% if room in device_room_map %}Hardware Connected{% else %}No Hardware Bound{% endif %}"></div>
                    
                    <div style="font-size: 40px; margin-bottom: 10px;">üè†</div>
                    <h3>{{ room.replace('_', ' ')|title }}</h3>
                    <p style="opacity: 0.6; font-size: 0.9em;">Tap to Control</p>
                </div>

                <div id="modal-{{ room }}" class="modal-overlay">
                    <div class="modal-content" onclick="event.stopPropagation()">
                        <span class="close-modal" onclick="closeRoomModal('{{ room }}')">&times;</span>
                        
                        <h2 class="text-center" style="margin-bottom: 5px;">{{ room.replace('_', ' ')|title }}</h2>
                        <p class="text-center" style="font-size:0.9em; opacity:0.7; margin-bottom:20px;">
                            Status: {% if room in device_room_map %}<span style="color:var(--primary);">Hardware Connected</span>{% else %}Offline{% endif %}
                        </p>
                        
                        <div class="mic-wrapper" style="text-align:center; margin: 20px 0;">
                            <button class="btn-mic push-to-talk" data-room="{{ room }}">
                                <svg viewBox="0 0 24 24"><path d="M12 14c1.66 0 3-1.34 3-3V5c0-1.66-1.34-3-3-3S9 3.34 9 5v6c0 1.66 1.34 3 3 3z"/><path d="M17 11c0 2.76-2.24 5-5 5s-5-2.24-5-5H5c0 3.53 2.61 6.43 6 6.92V21h2v-3.08c3.39-.49 6-3.39 6-6.92h-2z"/></svg>
                            </button>
                            <div class="mic-status" style="margin-top:5px; font-size:12px;">Tap to Command {{ room.replace('_', ' ')|title }}</div>
                        </div>

                        <div class="device-list">
                            {% for relay, data in devices.items() if relay.startswith('relay') %}
                                {% set relay_id = "switch-" + room + "-" + relay %}
                                {% set motion_id = "motion-" + room + "-" + relay %}
                                <div class="device-item">
                                    <span>{{ data.label }}</span>
                                    <div class="controls">
                                        <svg class="motion-icon {% if data.get('motion_control') %}active{% endif %}" 
                                            id="{{ motion_id }}"
                                            data-room="{{ room }}" data-relay="{{ relay }}"
                                            viewBox="0 0 24 24"><path d="M13.49 5.48c1.1 0 2-.9 2-2s-.9-2-2-2-2 .9-2 2 .9 2 2 2zm-3.6 13.9l1-4.4 2.1 2v6h2v-7.5l-2.1-2 .6-3c1.3 1.5 3.3 2.5 5.5 2.5v-2c-1.9 0-3.5-1-4.3-2.4l-1-1.6c-.4-.6-1-1-1.7-1-.3 0-.5.1-.8.1l-5.2 2.2v4.7h2v-3.4l1.8-.7-1.6 8.1-4.9-1-.4 2 7.7 1.6z"/></svg>
                                        <label class="switch">
                                            <input type="checkbox" class="relay-toggle" 
                                                id="{{ relay_id }}"
                                                data-room="{{ room }}" data-relay="{{ relay }}" 
                                                {% if data.status == 'ON' %}checked{% endif %}>
                                            <span class="slider"></span>
                                        </label>
                                    </div>
                                </div>
                            {% endfor %}
                        </div>
                    </div>
                </div>
                {% endfor %}
            </div>
        {% endif %}
    </main>

    <script src="{{ url_for('static', filename='script.js') }}"></script>
    <script>
        // Inline script for Modal control logic
        function openRoomModal(roomId) {
            document.getElementById('modal-' + roomId).classList.add('active');
        }
        function closeRoomModal(roomId) {
            document.getElementById('modal-' + roomId).classList.remove('active');
        }
    </script>
</body>
</html>